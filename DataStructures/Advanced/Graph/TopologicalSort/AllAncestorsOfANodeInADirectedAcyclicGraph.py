"""
https://leetcode.com/problems/all-ancestors-of-a-node-in-a-directed-acyclic-graph/

You are given a positive integer n representing the number of nodes of a Directed Acyclic Graph (DAG). The nodes are numbered from 0 to n - 1 (inclusive).

You are also given a 2D integer array edges, where edges[i] = [fromi, toi] denotes that there is a unidirectional edge from fromi to toi in the graph.

Return a list answer, where answer[i] is the list of ancestors of the ith node, sorted in ascending order.

A node u is an ancestor of another node v if u can reach v via a set of edges.



Example 1:


Input: n = 8, edgeList = [[0,3],[0,4],[1,3],[2,4],[2,7],[3,5],[3,6],[3,7],[4,6]]
Output: [[],[],[],[0,1],[0,2],[0,1,3],[0,1,2,3,4],[0,1,2,3]]
Explanation:
The above diagram represents the input graph.
- Nodes 0, 1, and 2 do not have any ancestors.
- Node 3 has two ancestors 0 and 1.
- Node 4 has two ancestors 0 and 2.
- Node 5 has three ancestors 0, 1, and 3.
- Node 6 has five ancestors 0, 1, 2, 3, and 4.
- Node 7 has four ancestors 0, 1, 2, and 3.
Example 2:


Input: n = 5, edgeList = [[0,1],[0,2],[0,3],[0,4],[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]]
Output: [[],[0],[0,1],[0,1,2],[0,1,2,3]]
Explanation:
The above diagram represents the input graph.
- Node 0 does not have any ancestor.
- Node 1 has one ancestor 0.
- Node 2 has two ancestors 0 and 1.
- Node 3 has three ancestors 0, 1, and 2.
- Node 4 has four ancestors 0, 1, 2, and 3.


Constraints:

1 <= n <= 1000
0 <= edges.length <= min(2000, n * (n - 1) / 2)
edges[i].length == 2
0 <= fromi, toi <= n - 1
fromi != toi
There are no duplicate edges.
The graph is directed and acyclic.
"""
from collections import defaultdict
from typing import List

from Common.ObjectTestingUtils import run_functional_tests


# WRONG
# class Solution:
#     def getAncestors(self, n: int, edges: List[List[int]]) -> List[List[int]]:
#         ascendants = [[] for _ in range(n)]
#         descendants = [[] for _ in range(n)]
#         for a, b in edges:
#             ascendants[b].append(a)
#             descendants[a].append(b)
#
#         level = {i: set() for i in range(n) if not ascendants[i]}
#         result = [set() for _ in range(n)]
#         while level:
#             next_level = defaultdict(list)
#             for node in level:
#                 result[node] += level[node]
#                 for child in descendants[node]:
#                     next_level[child] = paren.append(node)
#             level = next_level
#
#         return result


# TLE
# class Solution:
#     def getAncestors(self, n: int, edges: List[List[int]]) -> List[List[int]]:
#         adj = [[False for _ in range(n)] for _ in range(n)]
#         for a, b in edges:
#             adj[a][b] = True
#
#         for k in range(n):
#             for i in range(n):
#                 for j in range(n):
#                     adj[i][j] = adj[i][j] or (adj[i][k] and adj[k][j])
#
#         return [[j for j in range(n) if adj[j][i]] for i in range(n)]


# WRONG
# class Solution:
#     def getAncestors(self, n: int, edges: List[List[int]]) -> List[List[int]]:
#         ascendants = [[] for _ in range(n)]
#         descendants = [[] for _ in range(n)]
#         for a, b in edges:
#             ascendants[b].append(a)
#             descendants[a].append(b)
#
#         level = {i: [] for i in range(n) if not ascendants[i]}
#         result = [[] for _ in range(n)]
#         while level:
#             next_level = defaultdict(list)
#             for node in level:
#                 result[node] = level[node]
#                 for child in descendants[node]:
#                     for parent in level[node]:
#                         next_level[child].append(parent)
#                     next_level[child].append(node)
#             level = next_level
#
#         return result


# Runtime
# 1081 ms
# Beats
# 49.6%
# Memory
# 32.5 MB
# Beats
# 65.73%
# https://leetcode.com/problems/all-ancestors-of-a-node-in-a-directed-acyclic-graph/solutions/1821935/python3-java-c-simple-dfs-o-n-2/
class Solution:
    def getAncestors(self, n: int, edges: List[List[int]]) -> List[List[int]]:
        children = defaultdict(list)
        result = [[] for _ in range(n)]
        for a, b in edges:
            children[a].append(b)

        def dfs(node, curr):
            nonlocal result
            for child in children[curr]:
                if result[child] and result[child][-1] == node:
                    continue
                result[child].append(node)
                dfs(node, child)

        for i in range(n):
            dfs(i, i)
        return result


tests = [
    [593, [[333,339],[248,328],[234,374],[36,298],[423,370],[141,279],[344,423],[563,223],[24,158],[41,177],[138,466],[38,473],[518,220],[486,146],[7,148],[489,457],[549,382],[95,352],[484,558],[397,347],[198,246],[266,478],[547,33],[37,434],[242,68],[321,184],[448,186],[232,425],[114,549],[37,317],[182,189],[484,53],[586,53],[74,329],[112,374],[32,335],[389,114],[253,481],[260,322],[213,439],[237,449],[44,532],[347,578],[506,532],[570,218],[336,73],[118,539],[197,8],[453,89],[154,396],[99,578],[274,180],[523,29],[449,413],[72,295],[341,372],[253,348],[70,193],[207,513],[430,578],[341,114],[469,550],[224,402],[577,529],[275,18],[137,520],[394,238],[176,485],[513,493],[129,158],[39,178],[182,397],[369,425],[401,551],[412,63],[243,471],[391,472],[512,424],[159,370],[171,529],[360,180],[344,20],[421,527],[15,530],[239,146],[243,77],[51,9],[193,347],[552,362],[100,572],[276,7],[351,86],[321,289],[0,131],[507,586],[373,225],[146,290],[434,430],[172,265],[565,360],[470,66],[281,68],[506,471],[180,94],[38,261],[75,445],[118,351],[356,578],[154,488],[154,38],[206,153],[127,338],[476,218],[333,323],[206,249],[405,160],[42,453],[247,140],[336,181],[365,103],[135,542],[528,483],[425,509],[517,505],[464,287],[574,324],[87,269],[60,578],[255,223],[255,241],[16,339],[430,250],[114,240],[168,173],[356,45],[502,403],[138,148],[316,235],[182,573],[395,52],[544,45],[327,142],[397,183],[26,189],[352,387],[392,287],[45,139],[298,338],[485,55],[93,28],[123,190],[468,34],[576,391],[150,87],[449,28],[339,159],[275,197],[374,544],[208,393],[493,351],[320,245],[279,578],[32,31],[248,561],[114,129],[143,250],[96,66],[541,429],[15,551],[123,519],[74,69],[99,3],[258,133],[320,60],[436,581],[444,564],[377,306],[251,424],[201,375],[30,303],[584,238],[496,538],[331,99],[576,514],[510,221],[462,339],[267,218],[17,550],[532,430],[389,292],[18,160],[244,537],[11,292],[243,434],[357,467],[431,318],[446,250],[591,319],[405,150],[556,372],[13,370],[322,521],[119,434],[218,542],[249,393],[278,568],[518,479],[340,111],[142,229],[460,60],[122,166],[304,398],[548,104],[410,31],[106,588],[429,430],[541,269],[156,215],[523,319],[506,355],[50,104],[504,86],[461,306],[526,434],[126,490],[492,389],[249,262],[285,229],[176,476],[397,34],[10,549],[57,587],[285,86],[486,303],[277,76],[118,465],[513,139],[407,542],[499,324],[490,559],[591,472],[140,420],[558,370],[61,162],[335,68],[232,58],[366,509],[572,27],[247,146],[177,400],[542,144],[226,186],[353,439],[444,434],[47,208],[426,489],[11,550],[360,517],[386,438],[272,34],[183,159],[162,471],[356,311],[40,307],[123,229],[253,229],[371,143],[460,328],[408,543],[170,489],[490,532],[541,151],[563,476],[451,143],[78,517],[558,60],[214,559],[357,471],[425,478],[3,544],[325,183],[61,38],[550,347],[149,579],[99,391],[64,159],[566,262],[313,521],[182,386],[221,420],[135,506],[173,476],[188,52],[6,47],[391,339],[516,119],[391,501],[496,156],[104,382],[127,339],[65,19],[158,236],[12,245],[120,534],[278,236],[196,121],[220,407],[30,506],[546,498],[2,73],[329,583],[258,416],[528,151],[363,351],[476,430],[21,423],[288,533],[436,268],[213,352],[564,99],[537,373],[446,23],[36,118],[434,351],[525,424],[395,271],[308,285],[372,347],[186,558],[556,557],[418,480],[69,66],[366,261],[127,247],[418,475],[122,161],[466,319],[25,14],[206,420],[439,375],[37,576],[156,132],[42,100],[98,116],[31,259],[280,23],[352,29],[488,382],[58,400],[552,107],[531,461],[445,558],[266,173],[589,181],[57,136],[479,451],[55,400],[252,270],[223,60],[280,249],[320,201],[50,269],[287,581],[165,216],[117,365],[456,435],[423,362],[235,551],[589,462],[321,475],[145,471],[168,461],[364,280],[249,225],[526,183],[412,190],[534,430],[307,189],[27,386],[260,345],[66,183],[305,391],[496,197],[209,16],[378,530],[311,229],[211,319],[233,552],[378,194],[9,125],[33,521],[464,458],[95,401],[487,186],[211,190],[168,69],[214,96],[332,102],[437,338],[279,229],[195,162],[511,538],[542,530],[292,148],[382,229],[214,489],[546,510],[121,459],[309,30],[151,245],[42,185],[234,421],[562,208],[56,225],[531,77],[570,276],[164,458],[292,20],[173,433],[173,417],[483,113],[333,215],[568,34],[92,294],[106,517],[387,549],[347,44],[31,489]], [[],[],[],[99,331,444,564],[],[],[],[276,570],[197,275,496],[51],[],[],[],[],[25],[],[209],[],[275],[65],[11,292,344,389,492],[],[],[280,364,446],[],[],[],[42,100,572],[93,237,449],[95,213,352,523],[309],[32,410],[],[547],[182,272,278,397,468,568],[],[],[],[61,154],[],[],[],[],[],[11,17,70,182,193,341,347,372,397,469,550,556],[3,99,112,234,331,356,374,444,544,564],[],[6],[],[],[],[],[188,395],[484,507,586],[],[176,485],[],[],[232],[],[75,186,223,226,255,320,445,448,460,484,487,558,563],[],[],[412],[],[],[69,74,96,168,214,470],[],[32,242,281,335],[74,168],[],[],[],[2,336],[],[],[277],[243,531],[],[],[],[],[],[],[],[],[36,37,118,119,207,243,285,308,351,363,434,444,493,504,513,516,526],[150,405],[],[42,453],[],[],[],[],[180,274,360,565],[],[214],[],[],[331,444,564],[42],[],[332],[117,365],[50,548],[],[],[233,552],[],[],[],[340],[],[483,528],[341,389,492],[],[98],[],[36],[516],[],[196],[],[],[],[9,51],[],[],[],[114,341,389,492],[],[0],[156,496],[258],[],[],[57],[],[],[3,45,99,112,207,234,331,356,374,444,513,544,564],[127,247],[],[327],[371,451,479,518],[135,168,173,176,218,220,266,267,407,476,518,542,563,570],[],[127,239,247,486],[],[7,11,138,276,292,389,492,570],[],[405],[528,541],[],[206],[],[],[496],[],[24,114,129,341,389,492],[16,37,64,66,69,74,96,99,127,168,182,183,209,214,305,325,331,333,339,391,397,444,462,470,526,564,576,589],[18,275,405],[122],[61,195],[],[],[],[122],[],[],[],[],[],[],[168,266],[],[],[],[41],[39],[],[274,360,565],[336,589],[],[66,69,74,96,168,182,214,325,397,470,526],[321],[42],[226,448,487],[],[],[26,40,182,307],[123,211,412],[],[],[70],[378],[],[],[275,496],[],[],[],[320],[],[],[],[],[],[],[6,47,562],[],[],[],[],[],[],[156,333,496],[165],[],[168,173,176,266,267,476,563,570],[],[518],[510,546],[],[255,563],[],[56,206,244,249,280,364,373,537],[],[],[],[10,50,95,104,114,123,141,142,154,213,253,279,285,308,311,327,341,352,356,382,387,389,488,492,548,549],[],[],[],[],[],[316],[24,114,129,158,278,341,389,492],[],[394,584],[],[114,341,389,492],[255],[],[],[],[12,151,320,528,541],[198],[127],[],[206,280,364],[11,17,30,37,44,70,119,120,126,135,143,168,173,176,182,193,243,266,309,341,347,371,372,397,429,430,434,444,446,451,469,476,479,490,506,516,518,526,532,534,541,550,556,563],[],[],[],[],[],[],[],[],[31,32,410],[],[38,61,154,366],[206,249,280,364,566],[],[],[172],[],[],[436],[50,87,150,405,541],[252],[395],[],[],[],[],[570],[],[],[141],[364],[],[],[],[],[308],[],[392,464],[],[321],[127,146,239,247,486],[],[11,389,492],[],[92],[72],[],[],[36],[],[],[],[],[30,309,486],[],[],[168,377,461,531],[40],[],[],[],[356],[],[],[],[],[],[37],[431],[138,211,466,523,591],[],[],[260],[333],[499,574],[],[],[],[248,460],[74],[],[],[],[],[],[32],[],[],[36,127,298,437],[16,37,99,127,209,305,331,333,391,444,462,564,576,589],[],[],[],[],[],[260],[],[11,17,70,182,193,341,372,397,469,550,556],[253],[],[],[36,37,118,119,207,243,363,434,444,493,513,516,526],[95,213],[],[],[30,135,309,506],[],[],[],[],[565],[],[21,233,344,423,552],[],[],[117],[],[],[],[],[13,16,21,37,64,66,69,74,75,96,99,127,159,168,182,183,186,209,214,226,305,325,331,333,339,344,391,397,423,444,445,448,462,470,484,487,526,558,564,576,589],[],[341,556],[244,537],[112,234],[201,213,320,353,439],[],[],[],[],[],[],[10,50,95,104,114,154,213,341,352,387,389,488,492,548,549],[],[],[],[27,42,100,182,572],[95,213,352],[],[492],[],[37,99,305,331,444,564,576],[],[6,47,206,208,249,280,364,562],[],[],[154],[182],[304],[],[41,55,58,176,177,232,485],[95],[224],[502],[],[],[],[220,518],[],[],[],[],[],[237,449],[],[],[258],[168,173,266],[],[],[127,140,206,221,247,510,546],[234],[],[21,344],[251,512,525],[232,369],[],[],[],[541],[11,17,30,37,44,70,119,120,126,135,168,173,176,182,193,243,266,309,341,347,372,397,429,434,444,469,476,490,506,516,526,532,534,541,550,556,563],[],[],[168,173,266],[37,119,243,444,516,526],[456],[],[],[27,42,100,182,386,572],[213,353],[],[],[],[],[],[75],[],[],[],[237],[],[479,518],[],[42],[],[],[],[31,32,170,214,410,426,489],[164,464],[121,196],[],[168,531],[589],[],[],[36,118],[138],[357],[],[],[],[30,61,135,145,162,195,243,309,357,506],[37,99,305,331,391,444,564,576,591],[38,61,154],[],[321,418],[168,173,176,266,563],[],[232,266,369,425],[518],[418],[253],[],[528],[],[176],[],[],[154],[31,32,170,214,410,426],[126],[],[],[207,513],[],[],[],[],[546],[],[],[37,99,305,331,391,444,564,576],[],[],[],[78,106,360,517,565],[30,135,309],[],[],[232,366,369,425],[546],[],[],[207],[37,576],[],[],[78,106,360,565],[],[123],[137],[33,260,313,322,547],[],[],[],[],[],[234,421],[],[171,577],[15,135,168,173,176,218,220,266,267,378,407,476,518,542,563,570],[],[11,17,30,44,70,126,135,182,193,309,341,347,372,397,469,490,506,550,556],[288],[120],[],[],[244],[496,511],[36,118],[],[],[135,168,173,176,218,220,266,267,407,476,518,563,570],[408],[3,99,112,234,331,374,444,564],[],[],[],[],[10,95,114,213,341,352,387,389,492],[11,17,469],[15,95,235,316,401],[233],[],[],[],[],[556],[75,186,226,445,448,484,487],[126,214,490],[],[248],[],[],[444],[],[],[],[278],[],[],[],[42,100],[182],[],[],[37],[],[11,17,30,37,44,60,70,75,99,119,120,126,135,141,168,173,176,182,186,193,223,226,243,255,266,279,309,320,331,341,347,356,372,397,429,430,434,444,445,448,460,469,476,484,487,490,506,516,526,532,534,541,550,556,558,563,564],[149],[],[287,392,436,464],[],[74,329],[],[],[507],[57],[106],[],[],[],[]]],
    [8, [[0,3],[0,4],[1,3],[2,4],[2,7],[3,5],[3,6],[3,7],[4,6]], [[],[],[],[0,1],[0,2],[0,1,3],[0,1,2,3,4],[0,1,2,3]]],
    [5, [[0,1],[0,2],[0,3],[0,4],[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]], [[],[0],[0,1],[0,1,2],[0,1,2,3]]],
]

run_functional_tests(Solution().getAncestors, tests)
